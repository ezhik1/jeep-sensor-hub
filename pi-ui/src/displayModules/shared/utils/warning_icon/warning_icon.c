#include "warning_icon.h"
#include "../../../shared/palette.h"
#include <string.h>
#include <stdlib.h>

// Warning icon bitmap data from arduino projects
// This is a warning triangle icon that can be colorized at runtime

static const uint8_t warning_icon_16x16_data[] = {
	0x00, 0x00, 0x03, 0xc0, 0x02, 0x40, 0x04, 0x20, 0x04, 0x20, 0x09, 0x90, 0x19, 0x98, 0x11, 0x88,
	0x30, 0x0c, 0x20, 0x04, 0x40, 0x02, 0x41, 0x82, 0x80, 0x01, 0x80, 0x01, 0x7f, 0xfe, 0x00, 0x00
};

static const uint8_t warning_icon_30x30_data[] = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x80, 0x00, 0x00, 0x0f, 0xc0, 0x00, 0x00, 0x0c, 0xc0, 0x00,
	0x00, 0x18, 0x60, 0x00, 0x00, 0x38, 0x70, 0x00, 0x00, 0x30, 0x30, 0x00, 0x00, 0x70, 0x38, 0x00,
	0x00, 0x63, 0x18, 0x00, 0x00, 0xc7, 0x8c, 0x00, 0x00, 0xc7, 0x8c, 0x00, 0x01, 0x87, 0x06, 0x00,
	0x03, 0x83, 0x07, 0x00, 0x03, 0x03, 0x03, 0x00, 0x06, 0x03, 0x01, 0x80, 0x06, 0x03, 0x01, 0x80,
	0x0c, 0x03, 0x00, 0xc0, 0x0c, 0x03, 0x00, 0xc0, 0x18, 0x00, 0x00, 0x60, 0x38, 0x00, 0x00, 0x70,
	0x30, 0x03, 0x00, 0x30, 0x60, 0x07, 0x80, 0x18, 0x60, 0x03, 0x00, 0x18, 0xc0, 0x00, 0x00, 0x0c,
	0xc0, 0x00, 0x00, 0x0c, 0xe0, 0x00, 0x00, 0x1c, 0x7f, 0xff, 0xff, 0xf8, 0x3f, 0xff, 0xff, 0xf0,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

static const uint8_t warning_icon_50x50_data[] = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x03, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xfc,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x1e, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1e, 0x1e, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x3c, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x07, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x78, 0x07, 0x80, 0x00, 0x00, 0x00, 0x00, 0x70, 0x03, 0x80, 0x00, 0x00, 0x00, 0x00, 0xf0,
	0x03, 0xc0, 0x00, 0x00, 0x00, 0x01, 0xe0, 0x01, 0xe0, 0x00, 0x00, 0x00, 0x01, 0xe0, 0x01, 0xe0,
	0x00, 0x00, 0x00, 0x03, 0xc1, 0xe0, 0xf0, 0x00, 0x00, 0x00, 0x03, 0x83, 0xf0, 0xf0, 0x00, 0x00,
	0x00, 0x07, 0x83, 0xf0, 0x78, 0x00, 0x00, 0x00, 0x07, 0x03, 0xf0, 0x38, 0x00, 0x00, 0x00, 0x0f,
	0x03, 0xf0, 0x3c, 0x00, 0x00, 0x00, 0x1e, 0x03, 0xf0, 0x1e, 0x00, 0x00, 0x00, 0x1e, 0x01, 0xe0,
	0x1e, 0x00, 0x00, 0x00, 0x3c, 0x01, 0xe0, 0x0f, 0x00, 0x00, 0x00, 0x38, 0x01, 0xe0, 0x07, 0x00,
	0x00, 0x00, 0x78, 0x01, 0xe0, 0x07, 0x80, 0x00, 0x00, 0x70, 0x01, 0xe0, 0x03, 0x80, 0x00, 0x00,
	0xf0, 0x01, 0xe0, 0x03, 0xc0, 0x00, 0x01, 0xe0, 0x01, 0xe0, 0x01, 0xe0, 0x00, 0x01, 0xe0, 0x01,
	0xe0, 0x01, 0xe0, 0x00, 0x03, 0xc0, 0x01, 0xe0, 0x00, 0xf0, 0x00, 0x03, 0x80, 0x00, 0xc0, 0x00,
	0x70, 0x00, 0x07, 0x80, 0x00, 0xc0, 0x00, 0x78, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x38, 0x00,
	0x0f, 0x00, 0x00, 0x00, 0x00, 0x3c, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x1e, 0x00,
	0x01, 0xe0, 0x00, 0x1e, 0x00, 0x3c, 0x00, 0x03, 0xf0, 0x00, 0x0f, 0x00, 0x38, 0x00, 0x03, 0xf0,
	0x00, 0x07, 0x00, 0x78, 0x00, 0x03, 0xe0, 0x00, 0x07, 0x80, 0x70, 0x00, 0x01, 0xe0, 0x00, 0x03,
	0x80, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x03, 0xc0, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0xe0,
	0x00, 0x00, 0x00, 0x00, 0x01, 0xc0, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x03, 0x80, 0x7f, 0xff, 0xff,
	0xff, 0xff, 0xff, 0x80, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x1f, 0xff, 0xff, 0xff, 0xff,
	0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

static const uint8_t warning_icon_100x100_data[] = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xf8, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x3f, 0xff, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x7f, 0xff, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xe0,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xbf, 0xf0, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xfe, 0x07, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x01, 0xfc, 0x03, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x03, 0xfc, 0x03, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xf8, 0x01,
	0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xf0, 0x01, 0xfe, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xf0, 0x00, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x1f, 0xe0, 0x00, 0x7f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0xc0,
	0x00, 0x3f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0x80, 0x00, 0x3f, 0xc0,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0x80, 0x00, 0x1f, 0xc0, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0xff, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe,
	0x00, 0x00, 0x07, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xfe, 0x00, 0x00, 0x07,
	0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xfc, 0x00, 0x00, 0x03, 0xf8, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xf8, 0x00, 0x00, 0x03, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x07, 0xf8, 0x00, 0xe0, 0x01, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07,
	0xf0, 0x03, 0xfc, 0x00, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xf0, 0x07, 0xfe,
	0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xe0, 0x07, 0xfe, 0x00, 0x7f, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0xe0, 0x0f, 0xff, 0x00, 0x7f, 0x80, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x1f, 0xc0, 0x0f, 0xff, 0x00, 0x3f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x3f, 0x80, 0x0f, 0xff, 0x00, 0x3f, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0x80, 0x0f,
	0xff, 0x00, 0x1f, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0x00, 0x0f, 0xff, 0x00, 0x0f,
	0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x0f, 0xff, 0x00, 0x0f, 0xf0, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0xfe, 0x00, 0x0f, 0xfe, 0x00, 0x07, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x01, 0xfc, 0x00, 0x07, 0xfe, 0x00, 0x07, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xfc, 0x00,
	0x07, 0xfe, 0x00, 0x03, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xf8, 0x00, 0x07, 0xfe, 0x00,
	0x01, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xf8, 0x00, 0x07, 0xfe, 0x00, 0x01, 0xfc, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x07, 0xf0, 0x00, 0x07, 0xfe, 0x00, 0x00, 0xfe, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x0f, 0xf0, 0x00, 0x07, 0xfe, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xe0,
	0x00, 0x07, 0xfe, 0x00, 0x00, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0xe0, 0x00, 0x07, 0xfe,
	0x00, 0x00, 0x7f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x1f, 0xc0, 0x00, 0x07, 0xfe, 0x00, 0x00, 0x3f,
	0x80, 0x00, 0x00, 0x00, 0x00, 0x3f, 0x80, 0x00, 0x07, 0xfc, 0x00, 0x00, 0x1f, 0xc0, 0x00, 0x00,
	0x00, 0x00, 0x7f, 0x80, 0x00, 0x03, 0xfc, 0x00, 0x00, 0x1f, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x7f,
	0x00, 0x00, 0x03, 0xfc, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x03,
	0xfc, 0x00, 0x00, 0x0f, 0xf0, 0x00, 0x00, 0x00, 0x00, 0xfe, 0x00, 0x00, 0x03, 0xfc, 0x00, 0x00,
	0x07, 0xf0, 0x00, 0x00, 0x00, 0x01, 0xfc, 0x00, 0x00, 0x03, 0xfc, 0x00, 0x00, 0x07, 0xf8, 0x00,
	0x00, 0x00, 0x01, 0xfc, 0x00, 0x00, 0x03, 0xfc, 0x00, 0x00, 0x03, 0xf8, 0x00, 0x00, 0x00, 0x03,
	0xf8, 0x00, 0x00, 0x03, 0xfc, 0x00, 0x00, 0x01, 0xfc, 0x00, 0x00, 0x00, 0x07, 0xf8, 0x00, 0x00,
	0x03, 0xfc, 0x00, 0x00, 0x01, 0xfe, 0x00, 0x00, 0x00, 0x07, 0xf0, 0x00, 0x00, 0x03, 0xfc, 0x00,
	0x00, 0x00, 0xfe, 0x00, 0x00, 0x00, 0x0f, 0xf0, 0x00, 0x00, 0x03, 0xf8, 0x00, 0x00, 0x00, 0xff,
	0x00, 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x01, 0xf8, 0x00, 0x00, 0x00, 0x7f, 0x00, 0x00, 0x00,
	0x1f, 0xc0, 0x00, 0x00, 0x01, 0xf8, 0x00, 0x00, 0x00, 0x7f, 0x80, 0x00, 0x00, 0x1f, 0xc0, 0x00,
	0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0x3f, 0x80, 0x00, 0x00, 0x3f, 0x80, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x1f, 0xc0, 0x00, 0x00, 0x7f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x1f, 0xe0, 0x00, 0x00, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xe0, 0x00,
	0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xf0, 0x00, 0x00, 0xfe, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xf0, 0x00, 0x01, 0xfc, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x03, 0xf8, 0x00, 0x01, 0xfc, 0x00, 0x00, 0x00, 0x01, 0xf8, 0x00, 0x00,
	0x00, 0x03, 0xf8, 0x00, 0x03, 0xf8, 0x00, 0x00, 0x00, 0x03, 0xfc, 0x00, 0x00, 0x00, 0x01, 0xfc,
	0x00, 0x07, 0xf8, 0x00, 0x00, 0x00, 0x07, 0xfe, 0x00, 0x00, 0x00, 0x01, 0xfe, 0x00, 0x07, 0xf0,
	0x00, 0x00, 0x00, 0x07, 0xfe, 0x00, 0x00, 0x00, 0x00, 0xfe, 0x00, 0x0f, 0xf0, 0x00, 0x00, 0x00,
	0x0f, 0xff, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x0f, 0xff, 0x00,
	0x00, 0x00, 0x00, 0x7f, 0x00, 0x1f, 0xc0, 0x00, 0x00, 0x00, 0x0f, 0xff, 0x00, 0x00, 0x00, 0x00,
	0x3f, 0x80, 0x1f, 0xc0, 0x00, 0x00, 0x00, 0x07, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x3f, 0x80, 0x3f,
	0x80, 0x00, 0x00, 0x00, 0x07, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x1f, 0xc0, 0x7f, 0x80, 0x00, 0x00,
	0x00, 0x03, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x1f, 0xc0, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x01, 0xf8,
	0x00, 0x00, 0x00, 0x00, 0x0f, 0xe0, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x0f, 0xe0, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xe0,
	0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xf0, 0xfe, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xf0, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xf0, 0x7e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x07, 0xe0, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f,
	0xe0, 0x7f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0xe0, 0x3f, 0xff,
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x3f, 0xff, 0xff, 0xff, 0xff,
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
	0xff, 0xff, 0xff, 0xff, 0x80, 0x0f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
	0xff, 0x00, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x01,
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x00, 0x3f, 0xff, 0xff,
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	0x00, 0x00, 0x00, 0x00
};

static void canvas_cleanup_cb(lv_event_t* e) {
	lv_obj_t* canvas = lv_event_get_target(e);
	uint8_t* buffer = (uint8_t*)lv_obj_get_user_data(canvas);
	if (buffer) {
		free(buffer);
		lv_obj_set_user_data(canvas, NULL);
	}
}

static void draw_bitmap_to_canvas(lv_obj_t* canvas, int size, lv_color_t color) {
	lv_draw_buf_t* draw_buf = lv_canvas_get_draw_buf(canvas);
	if (!draw_buf || !draw_buf->data) return;

	uint16_t* buffer = (uint16_t*)draw_buf->data;
	uint16_t color_rgb565 = lv_color_to_u16(color);

	for (int y = 0; y < size; y++) {
		for (int x = 0; x < size; x++) {
			int byte_pos = 0;
			int bits_per_row = (size + 7) / 8;

			switch (size) {
				case 16: byte_pos = (y * bits_per_row) + (x / 8); break;
				case 30: byte_pos = (y * bits_per_row) + (x / 8); break;
				case 50: byte_pos = (y * bits_per_row) + (x / 8); break;
				case 100: byte_pos = (y * bits_per_row) + (x / 8); break;
			}

			int bit_pos = 7 - (x % 8);
			bool pixel_set = false;

			switch (size) {
				case 16:
					if (byte_pos < sizeof(warning_icon_16x16_data))
						pixel_set = warning_icon_16x16_data[byte_pos] & (1 << bit_pos);
					break;
				case 30:
					if (byte_pos < sizeof(warning_icon_30x30_data))
						pixel_set = warning_icon_30x30_data[byte_pos] & (1 << bit_pos);
					break;
				case 50:
					if (byte_pos < sizeof(warning_icon_50x50_data))
						pixel_set = warning_icon_50x50_data[byte_pos] & (1 << bit_pos);
					break;
				case 100:
					if (byte_pos < sizeof(warning_icon_100x100_data))
						pixel_set = warning_icon_100x100_data[byte_pos] & (1 << bit_pos);
					break;
			}

			if (pixel_set) {
				buffer[y * size + x] = color_rgb565;
			}
		}
	}

	lv_obj_invalidate(canvas);
}

lv_obj_t* warning_icon_create(lv_obj_t* parent, warning_icon_size_t size, lv_color_t color) {
	if (!parent) return NULL;

	int icon_size = (int)size;

	// Create canvas
	lv_obj_t* canvas = lv_canvas_create(parent);
	lv_obj_set_size(canvas, icon_size, icon_size);

	// Allocate buffer for THIS SPECIFIC icon (each icon needs its own buffer!)
	uint8_t* buffer = (uint8_t*)malloc(icon_size * icon_size * 2);
	if (!buffer) {
		lv_obj_del(canvas);
		return NULL;
	}

	// Store buffer pointer in user data for cleanup
	lv_obj_set_user_data(canvas, buffer);

	// Create canvas descriptor
	lv_canvas_set_buffer(canvas, buffer, icon_size, icon_size, LV_COLOR_FORMAT_RGB565);

	// Clear canvas
	lv_canvas_fill_bg(canvas, lv_color_black(), LV_OPA_COVER);

	// Draw bitmap to canvas
	draw_bitmap_to_canvas(canvas, icon_size, color);

	lv_obj_add_flag(canvas, LV_OBJ_FLAG_USER_1);

	// Add cleanup callback to free buffer when canvas is deleted
	lv_obj_add_event_cb(canvas, canvas_cleanup_cb, LV_EVENT_DELETE, NULL);

	return canvas;
}

void warning_icon_set_color(lv_obj_t* icon, lv_color_t color) {
	if (!icon || !lv_obj_has_flag(icon, LV_OBJ_FLAG_USER_1)) return;

	int icon_size = lv_obj_get_width(icon);

	// Clear and redraw with new color
	lv_canvas_fill_bg(icon, lv_color_black(), LV_OPA_COVER);
	draw_bitmap_to_canvas(icon, icon_size, color);
}

warning_icon_size_t warning_icon_get_size_from_coord(lv_coord_t coord) {
	if (coord <= 16) return WARNING_ICON_SIZE_16;
	if (coord <= 30) return WARNING_ICON_SIZE_30;
	if (coord <= 50) return WARNING_ICON_SIZE_50;
	return WARNING_ICON_SIZE_100;
}
